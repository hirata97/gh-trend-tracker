openapi: 3.0.0
info:
  title: GitHub Trend Tracker API
  version: 1.0.0
  description: |
      GitHubリポジトリのトレンドを取得するAPI
      
      ## 概要
      GitHub Trend Tracker APIは、GitHubリポジトリのトレンド情報を提供します。
      トレンドデータは日次で収集され、過去90日間の履歴を参照できます。
      
      ## 主な機能
      - 全言語のトレンドリポジトリ取得
      - 言語別トレンドリポジトリ取得
      - リポジトリの履歴データ取得
      - 対応言語一覧の取得
      
      ## 制限事項
      - トレンドエンドポイント: 上位100件まで
      - 履歴エンドポイント: 過去90日間まで
      
      ## エラーレスポンス
      すべてのエンドポイントは、エラー発生時に以下の形式でレスポンスを返します:
      
      ```json
      {
        "error": "エラーメッセージ",
        "code": "ERROR_CODE",
        "traceId": "abc123-def456"
      }
      ```
      
      ### エラーコード一覧
      - `VALIDATION_ERROR`: 入力バリデーションエラー
      - `NOT_FOUND`: リソースが見つからない
      - `DB_ERROR`: データベースエラー
      - `INTERNAL_ERROR`: 内部サーバーエラー
      
  contact:
    name: GitHub Trend Tracker
    url: "https://github.com/hirata97/gh-trend-tracker"
  license:
    name: MIT
servers:
  - url: "https://gh-trend-tracker.{user}.workers.dev"
    description: Production server
    variables:
      user:
        default: your-username
        description: Cloudflare Workersのユーザー名
  - url: "http://localhost:8787"
    description: Local development server
tags:
  - name: Health
    description: ヘルスチェックエンドポイント
  - name: Trends
    description: トレンドリポジトリ取得エンドポイント
  - name: Repositories
    description: リポジトリ情報取得エンドポイント
  - name: Languages
    description: 言語一覧取得エンドポイント
paths:
  /health:
    get:
      tags:
        - Health
      summary: ヘルスチェック
      description: APIサーバーの稼働状態を確認します
      responses:
        200:
          description: サービスが正常に稼働中
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: サービスの状態
                    example: ok
                  timestamp:
                    type: string
                    description: 現在のタイムスタンプ（ISO 8601形式）
                    example: "2026-01-17T12:00:00.000Z"
                required:
                  - status
                  - timestamp
  /api/trends:
    get:
      tags:
        - Trends
      summary: 全言語のトレンドを取得
      description: すべての言語のトレンドリポジトリ上位100件を取得します
      responses:
        200:
          description: トレンドリポジトリのリスト
          content:
            application/json:
              schema:
                type: object
                properties:
                  language:
                    type: string
                    description: 言語フィルター（指定された場合）
                    example: JavaScript
                  trends:
                    type: array
                    items:
                      type: object
                      properties:
                        repoId:
                          type: integer
                          minimum: 0
                          exclusiveMinimum: true
                          description: リポジトリID
                          example: 1
                        name:
                          type: string
                          description: リポジトリ名
                          example: react
                        fullName:
                          type: string
                          description: フルリポジトリ名
                          example: facebook/react
                        owner:
                          type: string
                          description: オーナー名
                          example: facebook
                        language:
                          type: string
                          nullable: true
                          description: 主要プログラミング言語
                          example: JavaScript
                        description:
                          type: string
                          nullable: true
                          description: リポジトリの説明
                          example: A declarative, efficient, and flexible JavaScript library for building user interfaces.
                        htmlUrl:
                          type: string
                          format: uri
                          description: GitHubリポジトリURL
                          example: "https://github.com/facebook/react"
                        currentStars:
                          type: integer
                          nullable: true
                          description: 現在のスター数（スナップショットがない場合はnull）
                          example: 230000
                        snapshotDate:
                          type: string
                          nullable: true
                          description: スナップショット日付
                          example: 2026-01-17
                      required:
                        - repoId
                        - name
                        - fullName
                        - owner
                        - language
                        - description
                        - htmlUrl
                        - currentStars
                    description: トレンドリポジトリのリスト
                required:
                  - trends
        500:
          description: サーバーエラー
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: エラーメッセージ
                    example: Failed to fetch trends
                  code:
                    type: string
                    enum:
                      - VALIDATION_ERROR
                      - NOT_FOUND
                      - DB_ERROR
                      - INTERNAL_ERROR
                    description: エラーコード
                    example: DB_ERROR
                  traceId:
                    type: string
                    description: トレース用ID（デバッグ用）
                    example: abc123-def456
                required:
                  - error
  /api/trends/{language}:
    get:
      tags:
        - Trends
      summary: 言語別トレンドを取得
      description: 指定した言語のトレンドリポジトリ上位100件を取得します
      parameters:
        - schema:
            type: string
            description: プログラミング言語名
            example: JavaScript
          required: true
          description: プログラミング言語名
          name: language
          in: path
      responses:
        200:
          description: 指定言語のトレンドリポジトリのリスト
          content:
            application/json:
              schema:
                type: object
                properties:
                  language:
                    type: string
                    description: 言語フィルター（指定された場合）
                    example: JavaScript
                  trends:
                    type: array
                    items:
                      type: object
                      properties:
                        repoId:
                          type: integer
                          minimum: 0
                          exclusiveMinimum: true
                          description: リポジトリID
                          example: 1
                        name:
                          type: string
                          description: リポジトリ名
                          example: react
                        fullName:
                          type: string
                          description: フルリポジトリ名
                          example: facebook/react
                        owner:
                          type: string
                          description: オーナー名
                          example: facebook
                        language:
                          type: string
                          nullable: true
                          description: 主要プログラミング言語
                          example: JavaScript
                        description:
                          type: string
                          nullable: true
                          description: リポジトリの説明
                          example: A declarative, efficient, and flexible JavaScript library for building user interfaces.
                        htmlUrl:
                          type: string
                          format: uri
                          description: GitHubリポジトリURL
                          example: "https://github.com/facebook/react"
                        currentStars:
                          type: integer
                          nullable: true
                          description: 現在のスター数（スナップショットがない場合はnull）
                          example: 230000
                        snapshotDate:
                          type: string
                          nullable: true
                          description: スナップショット日付
                          example: 2026-01-17
                      required:
                        - repoId
                        - name
                        - fullName
                        - owner
                        - language
                        - description
                        - htmlUrl
                        - currentStars
                    description: トレンドリポジトリのリスト
                required:
                  - trends
        500:
          description: サーバーエラー
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: エラーメッセージ
                    example: Failed to fetch trends
                  code:
                    type: string
                    enum:
                      - VALIDATION_ERROR
                      - NOT_FOUND
                      - DB_ERROR
                      - INTERNAL_ERROR
                    description: エラーコード
                    example: DB_ERROR
                  traceId:
                    type: string
                    description: トレース用ID（デバッグ用）
                    example: abc123-def456
                required:
                  - error
  /api/repos/{repoId}/history:
    get:
      tags:
        - Repositories
      summary: リポジトリの履歴を取得
      description: 指定したリポジトリの過去90日間のスナップショット履歴を取得します
      parameters:
        - schema:
            type: string
            description: リポジトリID（正の整数）
            example: 1
          required: true
          description: リポジトリID（正の整数）
          name: repoId
          in: path
      responses:
        200:
          description: リポジトリの履歴スナップショットリスト
          content:
            application/json:
              schema:
                type: object
                properties:
                  history:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          minimum: 0
                          exclusiveMinimum: true
                          description: スナップショットID
                          example: 1
                        repoId:
                          type: integer
                          minimum: 0
                          exclusiveMinimum: true
                          description: リポジトリID
                          example: 1
                        stars:
                          type: integer
                          minimum: 0
                          description: スター数
                          example: 230000
                        forks:
                          type: integer
                          minimum: 0
                          description: フォーク数
                          example: 47000
                        watchers:
                          type: integer
                          minimum: 0
                          description: ウォッチャー数
                          example: 6700
                        openIssues:
                          type: integer
                          minimum: 0
                          description: オープンなIssue数
                          example: 1200
                        snapshotDate:
                          type: string
                          description: スナップショット日付（YYYY-MM-DD形式）
                          example: 2026-01-17
                        createdAt:
                          type: string
                          description: 作成日時（ISO 8601形式）
                          example: "2026-01-17T00:00:00Z"
                      required:
                        - id
                        - repoId
                        - stars
                        - forks
                        - watchers
                        - openIssues
                        - snapshotDate
                        - createdAt
                    description: リポジトリの過去スナップショットリスト
                required:
                  - history
        400:
          description: 無効なリクエストパラメータ
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: エラーメッセージ
                    example: Failed to fetch trends
                  code:
                    type: string
                    enum:
                      - VALIDATION_ERROR
                      - NOT_FOUND
                      - DB_ERROR
                      - INTERNAL_ERROR
                    description: エラーコード
                    example: DB_ERROR
                  traceId:
                    type: string
                    description: トレース用ID（デバッグ用）
                    example: abc123-def456
                required:
                  - error
        404:
          description: リポジトリが見つからない
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: エラーメッセージ
                    example: Failed to fetch trends
                  code:
                    type: string
                    enum:
                      - VALIDATION_ERROR
                      - NOT_FOUND
                      - DB_ERROR
                      - INTERNAL_ERROR
                    description: エラーコード
                    example: DB_ERROR
                  traceId:
                    type: string
                    description: トレース用ID（デバッグ用）
                    example: abc123-def456
                required:
                  - error
        500:
          description: サーバーエラー
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: エラーメッセージ
                    example: Failed to fetch trends
                  code:
                    type: string
                    enum:
                      - VALIDATION_ERROR
                      - NOT_FOUND
                      - DB_ERROR
                      - INTERNAL_ERROR
                    description: エラーコード
                    example: DB_ERROR
                  traceId:
                    type: string
                    description: トレース用ID（デバッグ用）
                    example: abc123-def456
                required:
                  - error
  /api/languages:
    get:
      tags:
        - Languages
      summary: 言語一覧を取得
      description: データベースに存在するすべてのプログラミング言語のリストを取得します
      responses:
        200:
          description: 言語のリスト
          content:
            application/json:
              schema:
                type: object
                properties:
                  languages:
                    type: array
                    items:
                      type: string
                      nullable: true
                    description: 利用可能な言語のリスト
                    example:
                      - JavaScript
                      - TypeScript
                      - Python
                      - Go
                      - null
                required:
                  - languages
        500:
          description: サーバーエラー
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: エラーメッセージ
                    example: Failed to fetch trends
                  code:
                    type: string
                    enum:
                      - VALIDATION_ERROR
                      - NOT_FOUND
                      - DB_ERROR
                      - INTERNAL_ERROR
                    description: エラーコード
                    example: DB_ERROR
                  traceId:
                    type: string
                    description: トレース用ID（デバッグ用）
                    example: abc123-def456
                required:
                  - error