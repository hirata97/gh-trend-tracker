# CLAUDE.md

このファイルは、Claude Code（claude.ai/code）がこのリポジトリでコードを作業する際のガイダンスを提供します。

## 📋 プロジェクト概要

**GitHub Trend Tracker** は、GitHubリポジトリのトレンドを定量指標として抽出・可視化するWebサービスです。

### 目的

GitHub公式のTrendingは24時間/週間/月間の3区分のみで詳細な成長推移が見えず、スター数の絶対値だけでは「今伸びている」プロジェクトを発見しにくい。本サービスは、エンジニアが技術動向を効率的に把握できるようにします。

### ターゲットユーザー

| ペルソナ     | ニーズ                                      |
| ------------ | ------------------------------------------- |
| エンジニア   | 日常的に技術トレンドをチェックしたい        |
| テックリード | チームへの技術導入判断の材料が欲しい        |
| ブロガー     | 週次/月次の技術トレンド記事のネタを探したい |
| 技術選定者   | 新技術の成長性を定量的に評価したい          |

## 🛠️ 技術スタック

| レイヤー        | 技術                      |
| --------------- | ------------------------- |
| Frontend        | Astro + React             |
| Backend         | Cloudflare Workers + Hono |
| Database        | Cloudflare D1 (SQLite)    |
| ORM             | Drizzle ORM               |
| 認証（Phase 3） | GitHub OAuth              |
| 決済（Phase 3） | Stripe                    |
| AI（Phase 3）   | Claude API / OpenAI API   |

**共通設定:**
- TypeScript（厳格モード有効）
- パッケージマネージャ: npm workspaces
- Node バージョン: >= 20.0.0

## 🗂️ プロジェクト構造

詳細は [アーキテクチャ](./docs/基本/アーキテクチャ.md) を参照してください。

```
gh-trend-tracker/
├── apps/
│   ├── backend/                # Cloudflare Workers API
│   │   ├── src/
│   │   │   ├── routes/         # エンドポイント定義
│   │   │   ├── shared/         # Backend内共通コード
│   │   │   └── db/schema.ts    # Drizzle ORM スキーマ
│   │   └── schema/schema.sql   # D1 SQLスキーマ
│   │
│   └── frontend/               # Astro フロントエンド
│       └── src/
│
├── shared/                     # Backend/Frontend間の共有型定義
├── docs/                       # ドキュメント
└── CLAUDE.md
```

## 📚 ドキュメント体系

開発時に参照すべきドキュメント一覧：

### 基本ドキュメント

| ドキュメント                                             | 概要                                       | 用途                   |
| -------------------------------------------------------- | ------------------------------------------ | ---------------------- |
| [アーキテクチャ](./docs/基本/アーキテクチャ.md)          | システム構成、データフロー、共有コード境界 | システム全体の理解     |
| [セットアップガイド](./docs/基本/セットアップガイド.md)  | 環境構築手順、トラブルシューティング       | 開発環境の構築         |
| [開発ガイド](./docs/基本/開発ガイド.md)                  | コマンド一覧、コーディング規約、制約事項   | 日常的な開発作業       |
| [ロードマップ](./docs/基本/ロードマップ.md)              | 開発計画、機能実装状況                     | 開発優先順位の把握     |

### 設計ドキュメント

| ドキュメント                                             | 概要                           | 用途                   |
| -------------------------------------------------------- | ------------------------------ | ---------------------- |
| [API定義](./docs/設計/API定義.md)                        | エンドポイント詳細仕様         | API実装・利用          |
| [テーブル定義](./docs/設計/テーブル定義.md)              | データベーススキーマ           | DB設計・クエリ実装     |
| [画面一覧](./docs/設計/画面一覧.md)                      | 画面構成・コンポーネント定義   | フロントエンド実装     |

### 要件ドキュメント

| ドキュメント                                                 | 概要                           | 用途                   |
| ------------------------------------------------------------ | ------------------------------ | ---------------------- |
| [プロジェクト概要](./docs/要件定義/プロジェクト概要.md)      | サービスの目的・背景           | プロジェクト理解       |
| [業務要件一覧](./docs/要件定義/業務要件一覧.md)              | 業務要件（req-XXX）            | 要件確認               |
| [機能要件一覧](./docs/要件定義/機能要件一覧.md)              | 機能要件（fun-XXX）            | 機能実装時の仕様確認   |
| [非機能要件一覧](./docs/要件定義/非機能要件一覧.md)          | 非機能要件（non-XXX）          | 性能・セキュリティ要件 |

### プロセスドキュメント

| ドキュメント                                                         | 概要                     | 用途               |
| -------------------------------------------------------------------- | ------------------------ | ------------------ |
| [開発プロセス](./docs/プロセス/開発プロセス.md)                      | 開発フロー、品質基準     | 開発手順の確認     |
| [GitHub Actions設定](./docs/プロセス/GitHubActions設定.md)           | 自動データ収集設定       | CI/CD設定          |

## 🎯 開発フェーズ

| Phase                | 状態   | 主な機能                                                                                                            |
| -------------------- | ------ | ------------------------------------------------------------------------------------------------------------------- |
| **Phase 1 (MVP)**    | 実装中 | トレンドランキング一覧（Top 100）、言語フィルタリング、7日/30日スター増加数表示、リポジトリ詳細（90日間推移グラフ） |
| **Phase 2 (拡張)**   | 計画中 | リポジトリ名検索、お気に入り（ローカルストレージ）、週別トレンドランキング、ソート機能                              |
| **Phase 3 (収益化)** | 将来   | GitHub OAuth認証、AI要約機能（課金/無料プレビュー）、Stripe決済連携                                                 |

詳細は [ロードマップ](./docs/基本/ロードマップ.md) を参照してください。

## ⚡ クイックリファレンス

### よく使うコマンド

```bash
# 開発サーバー起動
npm run dev:backend   # API: http://localhost:8787
npm run dev:frontend  # Web: http://localhost:4321

# テスト実行
npm run test:backend

# データ収集
cd apps/backend && npm run collect
```

詳細は [開発ガイド](./docs/基本/開発ガイド.md) を参照してください。

### APIエンドポイント

**閲覧系:**
- `GET /api/trends/daily` - 日次トレンドランキング（ソート・ページネーション対応）
- `GET /api/repositories/:repoId` - リポジトリ詳細＋90日間スター推移
- `GET /api/languages` - 言語一覧

**バッチ処理系（GitHub Actions専用）:**
- `POST /api/internal/batch/collect-daily` - 日次データ収集（bac-011）
- `POST /api/internal/batch/calculate-metrics` - メトリクス計算（bac-012）
- `POST /api/internal/batch/calculate-weekly` - 週別トレンド集計（bac-013）

詳細は [API定義](./docs/設計/API定義.md) を参照してください。

### 共有コードの境界ルール

| 配置場所                    | 用途                               | 例                                  |
| --------------------------- | ---------------------------------- | ----------------------------------- |
| `apps/backend/src/shared/`  | **Backend内でのみ**使用するコード  | DBクエリ関数、API固有ユーティリティ |
| `apps/frontend/src/shared/` | **Frontend内でのみ**使用するコード | UIユーティリティ、フォーマッター    |
| `shared/`                   | **複数アプリ間**で共有する型定義   | APIレスポンス型、共通エンティティ型 |

**判断基準**: 2つ以上のアプリで使用する場合のみ `shared/` に配置する。

詳細は [アーキテクチャ](./docs/基本/アーキテクチャ.md) を参照してください。

## ⚠️ 重要な注意事項

### 必須チェック項目

- ✅ **スキーマ同期**: `apps/backend/src/db/schema.ts`と`apps/backend/schema/schema.sql`は常に同期を保つこと
- ✅ **未使用変数**: アンダースコアプレフィックス（`_var`）で回避せず、根本的に解決すること
- ✅ **コメント言語**: コード内のコメントは日本語で記述すること
- ✅ **共有型**: Backend/Frontend間で共有する型は`shared/src/index.ts`に定義すること
- ✅ **データベースID**: `wrangler.jsonc`のD1データベースIDは環境固有、不用意にコミットしないこと

### 現在の制約（本番環境対応が必要）

- ⚠️ **CORS**: 現在すべてのオリジンを許可（`cors()`ミドルウェア）→ 本番環境では制限が必要
- ⚠️ **エラーハンドリング**: 汎用500エラーを返す → より具体的なエラーハンドリングが必要
- ⚠️ **クエリ制限**: トレンド100件、履歴90日間に制限済み

詳細は [開発ガイド](./docs/基本/開発ガイド.md) を参照してください。

## 📖 開発時のワークフロー

新規機能追加や大規模な改修を行う前に、以下を確認すること：

1. **要件確認**: [要件定義](./docs/要件定義/) で関連する業務要件・機能要件を確認
2. **設計確認**: [システム設計](./docs/設計/) でAPI定義・テーブル定義・画面設計を確認
3. **フェーズ確認**: 実装対象がどのPhaseに属するか [ロードマップ](./docs/基本/ロードマップ.md) で確認（Phase 1が優先）
4. **実装**: [開発ガイド](./docs/基本/開発ガイド.md) のコーディング規約に従って実装
5. **テスト**: 新機能には対応するテストを追加
6. **ドキュメント更新**: API変更時は [API定義](./docs/設計/API定義.md) を更新

詳細は [開発プロセス](./docs/プロセス/開発プロセス.md) を参照してください。

## 🎓 要件ID体系

ドキュメント内で使用される要件ID：

- `req-XXX`: 業務要件（34件）
- `fun-XXX`: 機能要件（54件）
- `non-XXX`: 非機能要件（16件）
- `bac-XXX`: バックエンドAPI（14件）
- `scr-XXX`: 画面定義（11件）

## 🔍 成功指標

- LCP 2秒以内
- API応答時間 P95 200ms以内
- 稼働率 99%以上

---

**このドキュメントは参照用のインデックスです。詳細情報は各リンク先のドキュメントを参照してください。**
