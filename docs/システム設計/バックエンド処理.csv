"id","分類","処理名","概要","操作手順","ファイル名","関連する画面名","HTTPメソッド","ルートパス","OpenAPI仕様"
"bac-001","閲覧","日次トレンドランキング一覧取得","指定された言語、ソート基準、ページ番号に基づいて、リポジトリの日次トレンドランキング一覧（最大100件）を取得する。7日間および30日間のスター増加数/率を含む。（機能: fun-001, 002, 004, 005, 007, 008, 009, 010, 053）","リクエストされた言語、ソート基準（7日/30日増加数/率、総スター数）、ページネーションパラメータを検証する。DB（repositories, metrics_daily）から最新の日次メトリクスを結合して取得し、ソート・フィルタリング・ページネーションを適用してクライアントに返却する。","trends-daily.ts","scr-001","GET","/api/trends/daily","[object Object]"
"bac-002","閲覧","リポジトリ詳細情報と90日間スター推移取得","特定のリポジトリIDに基づき、基本情報、トピックス、および過去90日間の日次スター数スナップショットデータを取得する。（機能: fun-012, 048）","パスパラメータからリポジトリIDを取得し、repositoriesテーブルから基本情報を、repo_snapshotsテーブルから過去90日間の時系列データを取得する。グラフ描画用に整形して返却する。","repositories-[repoId].ts","scr-002","GET","/api/repositories/{repoId}","[object Object]"
"bac-003","検索","リポジトリ名検索実行","検索クエリ文字列に基づき、リポジトリ名（フルネームまたは部分一致）を検索し、一覧を返却する。（機能: fun-016）","クエリパラメータから検索文字列を取得し、repositoriesテーブルに対して部分一致検索を実行する。結果をリストとして返却する。","repositories-search.ts","scr-001, scr-004","GET","/api/repositories/search","[object Object]"
"bac-004","週別分析","週別トレンドランキング取得","指定された年、週番号、言語に基づき、週別集計ランキングデータ（ranking_weekly）を取得する。（機能: fun-019, 020）","クエリパラメータから年、週、言語の情報を取得する。ranking_weeklyテーブルから該当する週のJSONデータを取得し、ランキング一覧として整形して返却する。","trends-weekly.ts","scr-003","GET","/api/trends/weekly","[object Object]"
"bac-005","週別分析","閲覧可能な過去週リスト取得","データが存在する過去の週（年とISO週番号）の一覧をDBから取得し、期間選択ナビゲーションに提供する。（機能: fun-021）","ranking_weeklyテーブルから DISTINCT (year, week_number) のリストを取得する。必要に応じてソートして返却する。","trends-weekly-available.ts","scr-003","GET","/api/trends/weekly/available-weeks","[object Object]"
"bac-006","認証","GitHub OAuth認証コールバック処理","GitHubからの認証コードを受け取り、トークン交換、ユーザー情報取得、DB (users) への登録/ログイン処理、セッション/JWT生成を行う。（機能: fun-031, 032）","GitHubからコールバックされた認証コードとstateを検証し、GitHub APIでアクセストークンを取得する。ユーザー情報を取得し、usersテーブルにUpsert（更新または挿入）する。ログインセッション（JWT）を生成し、クライアントにセットしてメイン画面にリダイレクトする。","auth-callback-github.ts","scr-011","GET","/api/auth/callback/github","[object Object]"
"bac-007","AI機能","リポジトリAI要約取得（権限チェック込み）","指定されたリポジトリのAI要約データを取得する。ユーザーのログイン状態と課金プランに応じて、全文またはプレビューを出し分ける。（機能: fun-035, 037）","リポジトリIDとユーザーのセッション情報に基づき、fun-034 (機能アクセス権限判定) を実行する。ai_summariesテーブルから要約データを取得し、権限に応じて全文 (fun-035) またはプレビュー (fun-037) を整形して返却する。","repositories-[repoId]-summary.ts","scr-005, scr-006","GET","/api/repositories/{repoId}/summary","[object Object]"
"bac-008","AI機能","AI要約オンデマンド生成要求","課金ユーザーが未生成のリポジトリに対してAI要約の生成を要求する。クレジット残高/制限を確認し、非同期生成ジョブをキューに入れる。（機能: fun-039, 040, 054）","ユーザー認証と課金プランを確認する。fun-040（クレジット/制限の確認）を実行し、許可された場合、クレジットを消費または制限を適用する。非同期のAI生成ジョブをトリガーし、生成状態を返す。","repositories-[repoId]-generate.ts","scr-007","POST","/api/repositories/{repoId}/summary/generate","[object Object]"
"bac-009","課金/拡張","Stripe Checkoutセッション生成","ユーザーが選択した課金プランに基づき、Stripe Checkoutセッションを生成し、決済用URLを返す。（機能: fun-049）","ログインユーザーIDと選択プラン情報を受け取り、Stripe APIを呼び出す。Checkoutセッションを生成し、ユーザーをStripeの決済ページにリダイレクトするためのURLを返す。","billing-checkout.ts","scr-008","POST","/api/billing/checkout","[object Object]"
"bac-010","課金/拡張","Stripe Webhookによる決済イベント処理","Stripeからの決済成功/失敗イベントを受信し、署名検証後、ユーザーの課金プランやクレジット情報をDBに反映する。（機能: fun-050, 051, 033）","StripeからWebhookペイロードを受信し、署名を検証する。イベントタイプ（例: checkout.session.completed, customer.subscription.updated）に基づき、ユーザーDB (users) のプラン情報やクレジットを更新する。","webhook-stripe.ts","scr-009","POST","/api/webhook/stripe","[object Object]"
"bac-011","データ処理","日次データ収集＆スナップショット保存","定期実行されるバッチ処理。追跡対象リポジトリの最新情報をGitHub APIから取得し、マスタ情報 (repositories) を更新し、日次スナップショット (repo_snapshots) を保存する。（機能: fun-023, 024, 052）","日次でスケジュール実行される。GitHub APIを呼び出し、リポジトリの最新のスター数、フォーク数などを取得。repositoriesテーブル (fun-052) と repo_snapshotsテーブル (fun-024) に最新情報を保存する。","batch-collect-daily.ts","N/A (Internal)","POST","/api/internal/batch/collect-daily","[object Object]"
"bac-012","データ処理","7日間/30日間スター増加率計算","日次スナップショットデータに基づき、リポジトリごとの過去7日間および30日間のスター増加数/増加率を計算し、metrics_dailyテーブルに保存する。（機能: fun-027, 028）","日次バッチ実行後、repo_snapshotsテーブルを参照し、現在の日付と7日前、30日前のスター数を比較して増加数と増加率を計算する。結果をmetrics_dailyテーブルに保存し、日次ランキング表示の準備を行う。","batch-calculate-metrics.ts","N/A (Internal)","POST","/api/internal/batch/calculate-metrics","[object Object]"
"bac-013","データ処理","週別トレンド集計とランキング保存","週の変わり目（月曜未明）に実行され、過去7日間のスター増加数に基づき週別トレンドランキングを計算し、ranking_weeklyテーブルに保存する。（機能: fun-025, 026）","週次でスケジュール実行される。repo_snapshotsを参照して週間の増加数を計算。言語別にランキングを作成し、ranking_weeklyテーブルにJSON形式で結果を保存する。","batch-calculate-weekly.ts","N/A (Internal)","POST","/api/internal/batch/calculate-weekly","[object Object]"
"bac-014","AI機能","週別トップリポジトリAI要約自動生成","週別トレンドで注目されたリポジトリに対し、自動でAI要約を生成し、ai_summariesテーブルに保存する。（機能: fun-042, 043, 041）","週別トレンド集計後、ranking_weeklyからトップリポジトリリストを取得する。各リポジトリのREADME等をフェッチし、AI API (fun-041) を呼び出して構造化要約を生成。結果をai_summariesテーブルに保存する。","batch-generate-ai.ts","N/A (Internal)","POST","/api/internal/batch/generate-ai","[object Object]"