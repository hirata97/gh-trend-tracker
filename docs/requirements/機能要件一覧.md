# 機能要件一覧

システム実装の詳細要件を定義する。

## 閲覧機能

### fun-001: 言語別トレンド一覧表示

- **分類**: 閲覧
- **概要**: トップページまたは言語選択に基づき、対象言語のトレンドランキング（トップ100）を一覧で表示する
- **入力**: 選択言語（デフォルト: 全言語）
- **出力**: リポジトリのランキング一覧データ（最大100件）
- **利用者**: エンジニア
- **関連業務要件**: [req-001](./業務要件一覧.md#req-001-言語別トレンドランキング表示)

### fun-002: ランキングリポジトリ情報の取得

- **分類**: 閲覧
- **概要**: トレンド一覧表示に必要なリポジトリ名、スター数、フォーク数、概要などの基本情報をデータストアから取得する
- **入力**: リポジトリIDリスト
- **出力**: リポジトリ基本情報（名前、スター、フォーク、概要）
- **利用者**: エンジニア

### fun-003: リポジトリ基本情報のリスト表示

- **分類**: 閲覧
- **概要**: ランキングリストの各項目に、リポジトリ名、概要、スター総数、フォーク総数を表示する
- **入力**: リポジトリ基本情報データ
- **出力**: 整形されたリストビュー
- **利用者**: エンジニア

## メトリクス機能

### fun-004: 7日間スター増加数の表示

- **分類**: メトリクス
- **概要**: トレンド一覧の各リポジトリについて、事前計算された過去7日間のスター増加数を表示する
- **入力**: リポジトリID
- **出力**: 7日間スター増加数
- **利用者**: テックリード
- **関連業務要件**: [req-003](./業務要件一覧.md#req-003-7日間スター増加数の表示)

### fun-005: 30日間スター増加数の表示

- **分類**: メトリクス
- **概要**: トレンド一覧の各リポジトリについて、事前計算された過去30日間のスター増加数を表示する
- **入力**: リポジトリID
- **出力**: 30日間スター増加数
- **利用者**: テックリード
- **関連業務要件**: [req-004](./業務要件一覧.md#req-004-30日間スター増加数の表示)

## フィルタリング機能

### fun-006: 言語選択UI提供

- **分類**: フィルタリング
- **概要**: TypeScript、Pythonなど、定義された言語リストからユーザーがフィルタリング対象の言語を選択できるUIを提供する
- **入力**: 言語リスト
- **出力**: 言語選択ドロップダウン/タブ
- **利用者**: エンジニア

### fun-007: 言語フィルタリングの適用

- **分類**: フィルタリング
- **概要**: 選択された言語に基づき、表示されるトレンドランキングを絞り込む
- **入力**: 選択言語
- **出力**: フィルタリングされたランキングデータ
- **利用者**: エンジニア

## ソート機能

### fun-008: 7日間増加率/数によるソート実行

- **分類**: ソート
- **概要**: 一覧表示データを、過去7日間のスター増加率または増加数に基づきソートする
- **入力**: ソート基準（7日間増加率/数）
- **出力**: ソート済みランキングデータ
- **利用者**: テックリード

### fun-009: 30日間増加率/数によるソート実行

- **分類**: ソート
- **概要**: 一覧表示データを、過去30日間のスター増加率または増加数に基づきソートする
- **入力**: ソート基準（30日間増加率/数）
- **出力**: ソート済みランキングデータ
- **利用者**: テックリード

### fun-010: スター総数によるソート実行

- **分類**: ソート
- **概要**: 一覧表示データを、現在のスター総数に基づき降順にソートする
- **入力**: ソート基準（スター総数）
- **出力**: ソート済みランキングデータ
- **利用者**: エンジニア

## 詳細閲覧機能

### fun-011: リポジトリ詳細ページへの遷移

- **分類**: 詳細閲覧
- **概要**: ランキングまたは検索結果から特定のリポジトリの詳細ページURLを生成し、遷移させる
- **入力**: リポジトリID
- **出力**: リポジトリ詳細ページ
- **利用者**: エンジニア

## 可視化機能

### fun-012: 過去90日間のスター推移データ取得

- **分類**: 可視化
- **概要**: 指定されたリポジトリについて、過去90日間の日次スター数スナップショットデータを取得する
- **入力**: リポジトリID
- **出力**: 90日間のスター数時系列データ
- **利用者**: テックリード

### fun-013: スター推移グラフの描画

- **分類**: 可視化
- **概要**: 取得した過去90日間のスター数推移データを折れ線グラフとして詳細ページに描画する
- **入力**: 90日間のスター数時系列データ
- **出力**: 折れ線グラフ
- **利用者**: テックリード

## 情報提供機能

### fun-014: データスナップショット日時表示

- **分類**: 情報提供
- **概要**: 画面上部（またはフッター）に、表示されているデータがGitHubから取得された最終日時（UTC 0:00）を明記する
- **入力**: 最終データ取得日時
- **出力**: 日時文字列
- **利用者**: ブロガー

## 検索機能

### fun-015: リポジトリ名検索入力フォームの提供

- **分類**: 検索
- **概要**: ユーザーがリポジトリ名を入力できる検索UI（インプットボックス）を提供する
- **入力**: なし
- **出力**: 検索入力UI
- **利用者**: エンジニア

### fun-016: リポジトリ名検索実行

- **分類**: 検索
- **概要**: 入力されたクエリに基づき、リポジトリ名（フルネームまたは部分一致）をデータストアから検索する
- **入力**: 検索クエリ文字列
- **出力**: 合致するリポジトリIDリスト
- **利用者**: エンジニア

### fun-017: 検索結果一覧の表示

- **分類**: 検索
- **概要**: 検索クエリに合致したリポジトリを一覧形式で表示する
- **入力**: 合致リポジトリリスト
- **出力**: 検索結果一覧ページ
- **利用者**: エンジニア

## 週別分析機能

### fun-018: 週別トレンドランキングページ表示

- **分類**: 週別分析
- **概要**: 週別トレンドランキングを閲覧するための専用ページを表示し、最新週のデータをデフォルトで表示する
- **入力**: 週/年情報（オプション）
- **出力**: 週別トレンドランキングページ
- **利用者**: ブロガー

### fun-019: 指定された週のランキングデータ取得

- **分類**: 週別分析
- **概要**: 過去の任意の週（ISO週番号）が選択された際、その週のスター増加数に基づくトップ10ランキングデータを取得する
- **入力**: 年、週番号、言語
- **出力**: 週別トップ10ランキングデータ
- **利用者**: ブロガー

### fun-020: 週別ランキングの言語フィルタリング適用

- **分類**: 週別分析
- **概要**: 週別トレンドランキングにおいても、言語フィルタリングを適用し、表示を絞り込む
- **入力**: 選択言語
- **出力**: 言語フィルタリングされた週別ランキングデータ
- **利用者**: ブロガー

### fun-021: 利用可能な過去週リスト取得

- **分類**: 週別分析
- **概要**: データが存在する過去の週（年とISO週番号）の一覧をDBから取得する
- **入力**: 言語（オプション）
- **出力**: 年/週番号のリスト
- **利用者**: エンジニア

### fun-022: 期間選択ナビゲーションUIの提供

- **分類**: 週別分析
- **概要**: 利用可能な週リストに基づき、ユーザーが過去の週を容易に選択できるナビゲーション（カレンダーやプルダウン）を提供する
- **入力**: 利用可能な週リスト
- **出力**: 期間選択UI
- **利用者**: エンジニア

## データ処理機能

### fun-023: GitHub APIからのリポジトリ情報取得

- **分類**: データ処理
- **概要**: 日次バッチ処理として、追跡対象の全リポジトリの最新スター数、フォーク数、基本情報をGitHub APIから取得する
- **入力**: リポジトリ名リスト
- **出力**: GitHub APIレスポンスデータ
- **利用者**: 技術選定者

### fun-024: 日次スナップショットデータのDB保存

- **分類**: データ処理
- **概要**: GitHub APIから取得した最新のスター数などのスナップショットデータを、日付タグを付けてDB（repo_snapshots）に保存する
- **入力**: GitHub APIレスポンスデータ
- **出力**: DB保存成功ログ
- **利用者**: 技術選定者

### fun-025: 週別トレンド集計ロジックの実行

- **分類**: データ処理
- **概要**: 週の変わり目（月曜未明）に、過去7日間のスナップショットデータに基づき、週単位のスター増加数を計算する
- **入力**: 過去7日間のスナップショットデータ
- **出力**: 週別ランキング計算結果
- **利用者**: 技術選定者

### fun-026: 週別集計結果のDB保存

- **分類**: データ処理
- **概要**: 計算した週別トレンドランキング（トップ10）の結果を、週番号、言語と関連付けて専用テーブルに保存する
- **入力**: 週別ランキング計算結果
- **出力**: DB保存成功ログ
- **利用者**: 技術選定者

### fun-027: 7日間/30日間スター増加数/率の計算ロジック実行

- **分類**: データ処理
- **概要**: 日次バッチまたは計算バッチとして、過去7日間および30日間のスター増加数と増加率をリポジトリごとに計算する
- **入力**: スナップショットデータ
- **出力**: 計算済みメトリクス
- **利用者**: 技術選定者

### fun-028: 計算済み増加率のDB保存

- **分類**: データ処理
- **概要**: 計算した7日間および30日間のスター増加数/増加率を、トレンド一覧表示のためにDBに保存する
- **入力**: 計算済みメトリクス
- **出力**: DB保存成功ログ
- **利用者**: 技術選定者

## UX/非機能

### fun-029: レスポンシブUI実装

- **分類**: UX/非機能
- **概要**: スマートフォン、タブレット、PCの各デバイス幅に応じて、レイアウトやナビゲーションを自動的に調整する
- **入力**: デバイス幅
- **出力**: 最適化された画面表示
- **利用者**: エンジニア

## 認証機能

### fun-030: GitHub OAuth認証開始リダイレクト

- **分類**: 認証
- **概要**: ユーザーがログインボタンを押した際、GitHub OAuth認証フローへリダイレクトする
- **入力**: ログイン要求
- **出力**: GitHub認証ページ
- **利用者**: エンジニア

### fun-031: OAuthコールバック時のユーザー登録/ログイン処理

- **分類**: 認証
- **概要**: GitHubから認証コールバックを受け取り、新規ユーザーの場合は登録、既存ユーザーの場合はログイン処理を行う
- **入力**: GitHub認証コード
- **出力**: 認証トークン、ユーザー情報
- **利用者**: エンジニア

### fun-032: ログインセッションの生成と保持

- **分類**: 認証
- **概要**: 認証成功後、JWT等を利用してセッションを生成し、ブラウザまたはKVストアに保持することでログイン状態を維持する
- **入力**: ユーザーID
- **出力**: 有効なセッション
- **利用者**: エンジニア

## 課金/権限機能

### fun-033: ユーザーの課金プラン情報の登録/更新

- **分類**: 課金/権限
- **概要**: サブスクリプション登録またはクレジット購入に応じて、ユーザーテーブルのプラン情報を更新する
- **入力**: プラン情報、クレジット数
- **出力**: ユーザーDB更新
- **利用者**: 技術選定者

### fun-034: 機能アクセス権限判定

- **分類**: 課金/権限
- **概要**: AI要約閲覧やオンデマンド生成要求など、特定の機能へのアクセス要求時に、ユーザーの課金プランとログイン状態を確認し、アクセス可否を判定する
- **入力**: ユーザーID, 要求機能
- **出力**: アクセス許可/拒否
- **利用者**: 技術選定者

## AI機能

### fun-035: AI要約全文の取得と表示（課金ユーザー向け）

- **分類**: AI機能
- **概要**: 課金ユーザーに対して、生成済みのリポジトリAI要約（構造化サマリー）の全文を取得し、スライド形式で表示する
- **入力**: リポジトリID, ユーザーID（課金判定済み）
- **出力**: AI要約スライド全文
- **利用者**: テックリード

### fun-036: AI要約スライド形式表示UIの提供

- **分類**: AI機能
- **概要**: AI要約データを、目次やページナビゲーションを備えたスライド形式のUIで表示する
- **入力**: 要約JSONデータ
- **出力**: スライドビュー
- **利用者**: エンジニア

### fun-037: AI要約プレビューの取得（無料ユーザー向け）

- **分類**: AI機能
- **概要**: 無料ユーザーに対して、AI要約の概要または最初の1ページ分のみを取得する
- **入力**: リポジトリID, ユーザーID（無料判定済み）
- **出力**: AI要約プレビューデータ
- **利用者**: エンジニア

### fun-038: AI要約プレビュー表示とアップグレード誘導

- **分類**: AI機能
- **概要**: プレビューデータ表示後、全文閲覧を促すアップグレード誘導メッセージやUIを表示する
- **入力**: AI要約プレビュー
- **出力**: プレビューUIと誘導メッセージ
- **利用者**: エンジニア

### fun-039: AI要約のオンデマンド生成要求受付

- **分類**: AI機能
- **概要**: 課金ユーザーからの未生成リポジトリに対するAI要約生成要求を受け付ける
- **入力**: リポジトリID, ユーザーID
- **出力**: 生成開始メッセージ
- **利用者**: テックリード

### fun-040: オンデマンド生成要求時のクレジット/制限の確認

- **分類**: AI機能
- **概要**: オンデマンド生成要求時に、ユーザーのクレジット残高または月間生成制限を確認する
- **入力**: ユーザーID, コスト
- **出力**: 残高チェック結果（許可/拒否）
- **利用者**: テックリード

### fun-041: AI APIを呼び出しリポジトリ概要を生成

- **分類**: AI機能
- **概要**: リポジトリのREADMEやメタ情報に基づいて、外部のAI API（Claude/GPT）を呼び出し、構造化された要約を生成する
- **入力**: リポジトリ情報テキスト
- **出力**: AI生成要約JSON
- **利用者**: テックリード

### fun-042: AI要約バッチ実行トリガー管理

- **分類**: AI機能
- **概要**: 週次で、注目のリポジトリ（週別トップ10など）を抽出し、AI要約のバッチ生成処理をスケジューリングする
- **入力**: 週次トップリポジトリリスト
- **出力**: バッチ実行指示
- **利用者**: 技術選定者

### fun-043: 週別トップリポジトリのAI要約自動生成

- **分類**: AI機能
- **概要**: バッチ処理として、抽出されたリポジトリのAI要約を自動的に生成し、DBに保存する
- **入力**: リポジトリIDリスト
- **出力**: AI要約データのDB保存
- **利用者**: 技術選定者

## UX/拡張機能

### fun-044: 言語フィルタ設定のブックマーク誘導UI表示

- **分類**: UX/拡張
- **概要**: ユーザーが特定の言語フィルタを適用した際、その設定を保存したり再訪しやすくするための誘導（UIヒント）を表示する
- **入力**: 言語フィルタリング状態
- **出力**: 誘導メッセージまたはボタン
- **利用者**: エンジニア

### fun-045: グラフデータのツールチップ表示

- **分類**: UX/可視化
- **概要**: スター推移グラフ上において、ユーザーがマウスオーバーした際に、特定日の正確なスター数と日次増加数を表示するツールチップ機能を提供する
- **入力**: グラフ上の座標
- **出力**: ツールチップ（日付、スター数、増加数）
- **利用者**: エンジニア

### fun-047: リポジトリのお気に入り状態のローカルストレージ保存

- **分類**: 拡張
- **概要**: ユーザーがリポジトリをお気に入り登録した際、ブラウザのローカルストレージを利用してその情報を保持する
- **入力**: リポジトリID, お気に入り操作
- **出力**: ローカルストレージデータ更新
- **利用者**: エンジニア

### fun-047b: ローカルストレージに保存されたお気に入り一覧表示

- **分類**: 拡張
- **概要**: ローカルストレージに保存されているお気に入りリポジトリの一覧を、認証状態にかかわらず表示する
- **入力**: ローカルストレージのお気に入りリスト
- **出力**: お気に入り一覧ページ
- **利用者**: エンジニア

### fun-048: リポジトリ詳細ページでのトピックス情報表示

- **分類**: 情報提供
- **概要**: リポジトリに設定されたGitHubのトピックス（タグ）を取得し、詳細ページに表示する
- **入力**: リポジトリトピックスデータ
- **出力**: トピックスラベル
- **利用者**: エンジニア

## 課金/拡張機能

### fun-049: Stripe Checkoutセッションの生成とリダイレクト

- **分類**: 課金/拡張
- **概要**: ユーザーが課金プランを選択した際、Stripe APIを呼び出し、決済を行うためのCheckoutセッションを生成し、ユーザーをStripeへリダイレクトする
- **入力**: 選択プラン、ユーザー情報
- **出力**: Stripe Checkout URL
- **利用者**: 技術選定者

### fun-050: Stripe Webhookによる決済イベント受信

- **分類**: 課金/拡張
- **概要**: Stripeからの決済成功/失敗などのWebhookイベントを受信し、データの整合性を担保する
- **入力**: Stripe Webhookペイロード
- **出力**: イベント処理結果ログ
- **利用者**: 技術選定者

### fun-051: 決済成功時のユーザー課金プランのアクティベーション処理

- **分類**: 課金/拡張
- **概要**: Stripe Webhookにより決済成功が確認された際、ユーザーテーブルの課金プラン情報（plan, subscription_expires_at, credits_remaining）を更新する
- **入力**: 決済成功イベント
- **出力**: ユーザーDB更新
- **利用者**: 技術選定者

### fun-052: リポジトリ情報マスタの正規化・更新

- **分類**: データ処理
- **概要**: 日次データ収集バッチ実行時に、リポジトリの基本情報（言語、オーナー名、URLなど）を最新化し、DB（repositories）に格納する
- **入力**: GitHub APIレスポンスデータ
- **出力**: repositoriesテーブル更新
- **利用者**: 技術選定者

### fun-053: 言語別ランキングのページネーション

- **分類**: 閲覧
- **概要**: トレンド一覧（Top 100）を複数ページに分割し、ユーザーがページを切り替えて閲覧できるようにする
- **入力**: ページ番号
- **出力**: 該当ページのランキングデータ
- **利用者**: エンジニア

### fun-054: オンデマンド生成要求後の生成状態通知

- **分類**: AI機能
- **概要**: オンデマンド生成が完了（または失敗）した後、ユーザーに結果を通知する（例：画面上のステータス更新、または通知システム利用）
- **入力**: 生成結果
- **出力**: ユーザーへの通知
- **利用者**: テックリード
